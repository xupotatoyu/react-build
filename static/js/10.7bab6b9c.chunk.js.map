{"version":3,"sources":["containters/Edit/Edit.js"],"names":["Edit","props","getInputValue","event","target","value","setState","title","fetchGet","url","self","fetch","then","response","json","myJson","data","editorState","BraftEditor","createEditorState","content","fetchPost","params","body","JSON","stringify","headers","method","res","errno","success","history","push","error","catch","console","submitContent","htmlContent","state","toHTML","match","id","param","log","saveContent","handleEditorChange","this","window","localStorage","getItem","back","style","margin","className","placeholder","onChange","onSave","type","onClick","React","Component"],"mappings":"qVAmDqBA,G,gEAEjB,WAAYC,GAAO,IAAD,8BAChB,cAAMA,IASRC,cAAc,SAACC,GACb,GAAGA,GAASA,EAAMC,QAAUD,EAAMC,OAAOC,MAAM,CAC7C,IAAIA,EAAQF,EAAMC,OAAOC,MACvB,EAAKC,SAAS,CACZC,MAAMF,MAdI,EAoBpBG,SAAW,SAACC,GACV,IAAIC,EAAI,eACRC,MAAMF,GACLG,MAAK,SAASC,GACb,OAAOA,EAASC,UAEjBF,MAAK,SAASG,GACbL,EAAKJ,SAAS,CACZU,KAAKD,EAAOC,KACZC,YAAYC,IAAYC,kBAAkBJ,EAAOC,KAAKI,SACtDb,MAAMQ,EAAOC,KAAKT,YA9BJ,EA+ClBc,UAAU,SAACZ,EAAIa,GACb,IAAIZ,EAAI,eACRC,MAAMF,EAAK,CACTc,KAAMC,KAAKC,UAAUH,GACrBI,QAAS,CACP,eAAgB,oBAElBC,OAAQ,SACPf,MAAK,SAAAC,GACN,OAAOA,EAASC,UACfF,MAAK,SAAAgB,GACW,IAAdA,EAAIC,OACL,IAAQC,QAAQ,2BAAO,GACvBpB,EAAKT,MAAM8B,QAAQC,KAAK,YAExB,IAAQC,MAAM,+BAEfC,OAAM,SAAAD,GAAK,OAAIE,QAAQF,MAAMA,OAhEhB,EAmElBG,cAAe,WAEX,IAAMC,EAAc,EAAKC,MAAMrB,YAAYsB,SACvC9B,EAAI,uBAAyB,EAAKR,MAAMuC,MAAMlB,OAAOmB,GACrDC,EAAQ,CACVnC,MAAO,EAAK+B,MAAM/B,MAClBa,QAASiB,GAEX,EAAKhB,UAAUZ,EAAIiC,GACnBP,QAAQQ,IAAI,iBA5EE,EA+ElBC,YAAY,WAEV,EAAK1C,gBACLiC,QAAQQ,IAAI,iBAlFI,EAqFlBE,mBAAqB,SAAC5B,GAClB,EAAKX,SAAS,CAAEW,iBApFlB,EAAKqB,MAAQ,CAEXrB,YAAaC,IAAYC,kBAAkB,MAC3CZ,MAAM,GACNS,KAAK,IANS,E,gLA2CZP,EAAM,uBAAyBqC,KAAK7C,MAAMuC,MAAMlB,OAAOmB,GAC3DK,KAAKtC,SAASC,G,iJA8CVsC,OAAOC,aAAaC,QAAQ,cAC9B,IAAQhB,MAAM,4BACdc,OAAOhB,QAAQmB,U,+BAGR,IAAD,OACEjC,EAAgB6B,KAAKR,MAArBrB,YACR,OACI,yBAAKkC,MAAO,CAACC,OAAO,SAClB,yBAAKC,UAAU,eACb,uBACAC,YAAY,eACZC,SAAU,SAAApD,GAAK,OAAE,EAAKD,cAAcC,IACpCE,MAAOyC,KAAKR,MAAM/B,SAGpB,yBAAK8C,UAAU,iBACb,kBAAC,IAAD,CACIhD,MAAOY,EACPsC,SAAUT,KAAKD,mBACfW,OAAQV,KAAKF,eAGnB,yBAAKS,UAAU,eACb,uBAAQI,KAAK,UAAUC,QAASZ,KAAKF,aAArC,gBACA,0BAAMS,UAAU,UAChB,uBAASI,KAAK,UAAUC,QAASZ,KAAKV,eAAtC,sB,GAtHkBuB,IAAMC,a","file":"static/js/10.7bab6b9c.chunk.js","sourcesContent":["import React from 'react';\r\n// 引入编辑器组件\r\nimport BraftEditor from 'braft-editor';\r\n// 引入编辑器样式\r\nimport 'braft-editor/dist/index.css';\r\n\r\nimport {Input,Button,message} from 'antd';\r\nimport './Edit.less';\r\n\r\n// class Md extends React.Component {\r\n//   state = {\r\n//     // 创建一个空的editorState作为初始值\r\n//     editorState: BraftEditor.createEditorState(null)\r\n// }\r\n\r\n// async componentDidMount () {\r\n//     // // 假设此处从服务端获取html格式的编辑器内容\r\n//     // const htmlContent = await fetchEditorContent()\r\n//     // // 使用BraftEditor.createEditorState将html字符串转换为编辑器需要的editorStat\r\n//     // this.setState({\r\n//     //     editorState: BraftEditor.createEditorState(htmlContent)\r\n//     // })\r\n// }\r\n\r\n// submitContent = async () => {\r\n//     // 在编辑器获得焦点时按下ctrl+s会执行此方法\r\n//     // 编辑器内容提交到服务端之前，可直接调用editorState.toHTML()来获取HTML格式的内容\r\n//     const htmlContent = this.state.editorState.toHTML()\r\n//     // const result = await saveEditorContent(htmlContent)\r\n// }\r\n\r\n// handleEditorChange = (editorState) => {\r\n//     this.setState({ editorState })\r\n// }\r\n\r\n// render () {\r\n\r\n//     const { editorState } = this.state\r\n//     return (\r\n//         <div className=\"my-component\">\r\n//             <BraftEditor\r\n//                 value={editorState}\r\n//                 onChange={this.handleEditorChange}\r\n//                 onSave={this.submitContent}\r\n//             />\r\n//         </div>\r\n//     )\r\n\r\n// }\r\n// }\r\n\r\nexport default class Edit extends React.Component { \r\n\r\n    constructor(props){\r\n      super(props)\r\n      this.state = {\r\n        // 创建一个空的editorState作为初始值\r\n        editorState: BraftEditor.createEditorState(null),\r\n        title:'',\r\n        data:{}\r\n      }\r\n    }\r\n    // 获取标题\r\n    getInputValue=(event)=>{\r\n      if(event && event.target && event.target.value){\r\n        let value = event.target.value;       \r\n          this.setState({\r\n            title:value\r\n          })\r\n      }\r\n    }\r\n\r\n    // 获取博客\r\n  fetchGet = (url)=>{\r\n    let self =this\r\n    fetch(url)\r\n    .then(function(response) {\r\n      return response.json();\r\n    })\r\n    .then(function(myJson) {\r\n      self.setState({\r\n        data:myJson.data,\r\n        editorState:BraftEditor.createEditorState(myJson.data.content),\r\n        title:myJson.data.title\r\n      })\r\n      // console.log('qqqq',self.state.data.data)\r\n    });\r\n  }\r\n    // 添加初始文本\r\n    async componentDidMount () {\r\n        // // 假设此处从服务端获取html格式的编辑器内容\r\n        // const htmlContent = await fetchEditorContent()\r\n        // // 使用BraftEditor.createEditorState将html字符串转换为编辑器需要的editorStat\r\n        // this.setState({\r\n        //     editorState: BraftEditor.createEditorState(htmlContent)\r\n        // })\r\n      let url = '/api/blog/detail?id=' + this.props.match.params.id\r\n      this.fetchGet(url)\r\n    }\r\n    // 提交请求\r\n    fetchPost=(url,params)=>{\r\n      let self = this\r\n      fetch(url, {\r\n        body: JSON.stringify(params),\r\n        headers: {\r\n          'content-type': 'application/json'\r\n        },\r\n        method: 'POST'\r\n      }).then(response=>{\r\n        return response.json()\r\n      }).then(res=>{\r\n        if(res.errno === 0){\r\n          message.success('修改成功',2)\r\n          self.props.history.push('/manage')\r\n        }else{\r\n          message.error('保存失败')\r\n        }\r\n      }).catch(error => console.error(error))\r\n    }\r\n    // 提交函数\r\n    submitContent =() => {\r\n        // 编辑器内容提交到服务端之前，可直接调用editorState.toHTML()来获取HTML格式的内容\r\n        const htmlContent = this.state.editorState.toHTML()\r\n        let url='/api/blog/update?id=' + this.props.match.params.id\r\n        let param = {\r\n          title: this.state.title,\r\n          content: htmlContent\r\n        }\r\n        this.fetchPost(url,param)\r\n        console.log('提交')\r\n    }\r\n\r\n    saveContent=()=> {\r\n      // 在编辑器获得焦点时按下ctrl+s会执行此方法\r\n      this.getInputValue()\r\n      console.log('保存')\r\n    }\r\n\r\n    handleEditorChange = (editorState) => {\r\n        this.setState({ editorState })\r\n    }\r\n    \r\n    componentWillMount(){\r\n      if(!window.localStorage.getItem('userName')){\r\n        message.error('请先登录')\r\n        window.history.back()\r\n      }\r\n    }\r\n    render () {\r\n        const { editorState } = this.state\r\n        return (\r\n            <div style={{margin:'30px'}}>\r\n              <div className=\"write-title\">\r\n                <Input \r\n                placeholder=\"标题\"\r\n                onChange={event=>this.getInputValue(event)}\r\n                value={this.state.title}\r\n                ></Input>\r\n              </div>\r\n              <div className=\"write-content\">\r\n                <BraftEditor\r\n                    value={editorState}\r\n                    onChange={this.handleEditorChange}\r\n                    onSave={this.saveContent}\r\n                />\r\n              </div>\r\n              <div className=\"edit-button\">\r\n                <Button type='primary' onClick={this.saveContent}>保存</Button>\r\n                <span className=\"wspan\"></span>\r\n                <Button  type='primary' onClick={this.submitContent}>提交</Button>\r\n              </div>\r\n            </div>\r\n        )\r\n \r\n    }\r\n \r\n}"],"sourceRoot":""}